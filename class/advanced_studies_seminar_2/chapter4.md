---
layout: page
title: "平均と分散"
permalink: /class/advanced_studies_seminar_2/chapter4.html
top_link: false
image: "https://i.gyazo.com/ed7170a7db899f62befa0559d7d8f834.png"
---

[![https://gyazo.com/ed7170a7db899f62befa0559d7d8f834](https://i.gyazo.com/ed7170a7db899f62befa0559d7d8f834.png)](https://gyazo.com/ed7170a7db899f62befa0559d7d8f834)

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">基本統計量

**統計量**とは、観測したデータそのものではなく、それらのデータの特徴を代表的に表す値のことを表します。
そのなかでも、**基本統計量** は、**平均**、**中央値**、**分散**、**標準偏差** などを指し、
データの特徴を把握するための基本的な指標となります。
今回は、これら基本統計量を、公式や関数を利用して計算してみましょう。
対象のデータとして[成績のデータ（CSV形式）](score.csv)を使用します。
このデータは15人の生徒の国語、算数、理科、英語、社会の得点で構成されています。

{% gist naoto-github/74c0bb69025aaa3afb44b8ef53df0c6b %}

ファイルをダウンロードしたら、**read.csv**関数を利用して、
変数scoreにデータフレームとして読み込んでおきましょう（作業ディレクトリはデスクトップに変更）。

    score <- read.csv("score.csv")

変数scoreの出力は下記のようになります。

    > score
            氏名 国語 算数 理科 英語 社会
    1  青木 達也   60   68   72   39   71
    2  石井 健二   65   78   82   37   75
    3  北村 真子   84   59   85   87   84
    4  河野 尚子   50   65   65   39   78
    5    高木 健   72   74   83   30   83
    6  西川 知里   50   29   67   62   72
    7  福島 萌子   84   40   65   86   66
    8  古川 翔太   78   71   82   34   88
    9  山内 香菜   77   33   65   73   88
    10 渡辺 太郎   76   53   75   60   71
    11   浅野 渉   68   46   77   66   86
    12   星野 弘   61   27   74   70   67
    13   中谷 章   86   57   72   73   65
    14 小泉 美沙   68   48   73   51   68
    15 木下 萌子   78   90  100   53   79

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">スクリプトの作成

コードを入力し保存するための**スクリプト**を作成しましょう。
[ファイル]-[新しいスクリプト]をクリックし、**Rエディタ**を表示します。
次に、[ファイル]-[保存]をクリックして、スクリプトを保存します。
このとき、ファイル名は**chapter4**としてください。
また、ファイルの保存場所と作業ディレクトリを**デスクトップ**に変更しておきます。

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">合計

基本統計量の前に**合計**を計算してみましょう。
例えば、国語の合計は、演算子**+**を利用して、次のように記述することができます。
ここで、nは要素の数を表しています。

<p style="text-align:center">
    <script type="math/tex">x_1 + x_2 + \cdots + x_n = 60 + 65 + \cdots + 78</script>
</p>

R言語では、もっと簡単に、**sum**という関数で合計を求めることができます。
国語の得点はデータフレームの2列目にあるため**score[,2]**と表記します。

    > score[,2]
     [1] 60 65 84 50 72 50 84 78 77 76 68 61 86 68 78
    > sum(score[,2])
    [1] 1057

国語の合計は1057になることが分かります。
同様に、算数の合計も計算してみましょう。

    > score[,3]
     [1] 68 78 59 65 74 29 40 71 33 53 46 27 57 48 90
    > sum(score[,3])
    [1] 838
    
算数の合計は838になります。

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">平均

それでは、最も有名な基本統計量である**平均**を計算してみましょう。
例えば、国語の平均を求めるには、次のように記述することができます。

<p style="text-align:center">
    <script type="math/tex">\mu = \frac{x_1 + x_2 + \cdots + x_n}{n} =\frac{ 60 + 65 + \cdots + 78}{15}</script>
</p>

まずは、先ほどの**sum**関数を利用して、国語の平均を計算してみましょう。
ここで、**length**関数はベクトルの長さを表します。

    > sum(score[,2])/length(score[,2])
    [1] 70.46667

国語の平均は約70.5になることが分かります。
R言語では、**mean**という関数で平均を求めることができます。
ちなみに、Excelでは**average**という関数が利用されます。
今度は関数を利用して計算してみましょう。

    > mean(score[,2])
    [1] 70.46667

先程、求めた値と同じであることが確認できます。

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">中央値

平均とよく似た基本統計量として、**中央値**があります。
中央値は、データを小さい順（大きい順でも構わない）から並べたときに、ちょうど中央にある値のことを指します。
例えば、[1,2,3,4,5]の中央値は、**3**になります。
また、[1,2,3,4,5,6]など値が偶数個の場合は、**(3+4/2)=3.5**が中央値です。

R言語では、**median**という関数で中央値を求めることができます。
国語の中央値を計算してみましょう。

    > median(score[,2])
    [1] 72

国語の中央値は72であることが分かります。  

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">分散

平均や中央値は、データの代表値であり、分布の中心位置を示しています（中心の考え方によるけど）。
データの傾向を把握するには、上記に加えて**散布度**を知る必要があります。
**散布度**とは、データの散らばり度合のことを意味しており、
平均値や中央値からどれだけ離れているかを示した値です。

まずは、**分散**を考えましょう。
分散は、各データの値から平均を引いた値（**偏差**）の2乗の和であり、下記のように記述することができます。
分散は**2乗の和**であるため、常に正の値となることに注意してください。

<p style="text-align:center">
    <script type="math/tex">\sigma^2 = \frac{(x_1 - \mu)^2 + (x_2 - \mu)^2 + \cdots + (x_n - \mu)^2}{n} =\frac{ (60 - 70.5)^2 + (65 - 70.5)^2 + \cdots + (78 - 70.5)^2}{15}</script>
</p>

まずは、これまでに学習した**sum**関数と**mean**関数を利用して、国語の分散を計算してみましょう。
スクリプトに下記を入力して、スクリプトを読み込み実行してください。

    #スコアの読込
    score <- read.csv("score.csv")

    #偏差を計算
    hensa <- score[,2] - mean(score[,2])

    #分散を計算
    bunsan <- sum(hensa^2 / length(score[,2]))

では、偏差と分散の値を確認してみましょう。

    > source("chapter4.R")
    > hensa
     [1] -10.466667  -5.466667  13.533333 -20.466667   1.533333 -20.466667
     [7]  13.533333   7.533333   6.533333   5.533333  -2.466667  -9.466667
    [13]  15.533333  -2.466667   7.533333
    > bunsan
    [1] 125.0489

国語の分散は約125になりました。

R言語では、**var**という関数で分散を求めることができます。
今度は、**var**関数で国語の分散を計算してみましょう。

    > var(score[,2])
    [1] 133.981

同じ値になると思いきや、なんと先程とは異なる結果となりました。
実は、先に計算した値は**標本分散**と呼ばれ、
データの全ての値が（もしくは、ほぼ全て）分かっているときに用いられ、
データの一部（サンプル）しか分からない場合は、真の分散より小さな値となります。
そこで、用いられるのが**不偏分散**であり、下記のように分母を**n-1**で割って求めます。

<p style="text-align:center">
    <script type="math/tex">\sigma^2 = \frac{(x_1 - \mu)^2 + (x_2 - \mu)^2 + \cdots + (x_n - \mu)^2}{n-1} =\frac{ (60 - 70.5)^2 + (65 - 70.5)^2 + \cdots + (78 - 70.5)^2}{14}</script>
</p>

では、スクリプトを修正して、再度、分散を計算してみましょう。

    #分散を計算
    bunsan <- sum(hensa^2 / (length(score[,2])-1))

    > bunsan
    [1] 133.981

国語の分散は約134となり、**var**関数の値と一致しました。    

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">標準偏差

最後に、**標準偏差**を計算しましょう。
**標準偏差**は、分散の値の平方根をとった値です。

<p style="text-align:center">
    <script type="math/tex">\sigma = \sqrt{\frac{(x_1 - \mu)^2 + (x_2 - \mu)^2 + \cdots + (x_n - \mu)^2}{n-1}} =\sqrt{\frac{ (60 - 70.5)^2 + (65 - 70.5)^2 + \cdots + (78 - 70.5)^2}{14}}</script>
</p>

国語の**標準偏差**を計算するために、
スクリプトに下記を入力して、スクリプトを読み込み実行してください。
平方根を取るには**sqrt**関数を利用します。

    #標準偏差
    hyojyun_hensa <- sqrt(bunsan)

では、標準偏差を確認してみましょう。

    > hyojyun_hensa
    [1] 11.57501

標準偏差は約11.6になりますね。
R言語では、**sd**という関数で、標準偏差を計算できます。
今度は、**sd**関数で標準偏差を計算してみましょう。

    > sd(score[,2])
    [1] 11.57501

先程の値と一致することが分かります。

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">課題

関数を利用して、数学の**合計**、**平均**、**中央値**、**分散**、**標準偏差**を計算して出力してください。
ソースは**chapter4.R**に記述し、**chapter4.R** を提出すること。

{% include advanced_studies_seminar_2/reference.html %}