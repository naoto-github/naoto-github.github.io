---
layout: page
title: "Excelを利用した統計処理・相関係数"
permalink: /class/seminar_core_areas_learning/chapter1.html
top_link: false
image: "https://i.gyazo.com/99f65fba3d840c29fa894e030989e166.png"
---

[![https://gyazo.com/99f65fba3d840c29fa894e030989e166](https://i.gyazo.com/99f65fba3d840c29fa894e030989e166.png)](https://gyazo.com/99f65fba3d840c29fa894e030989e166)

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">Microsoft Excelとは

Microsoft Excelは[マイクロソフト](https://www.microsoft.com/ja-jp/)が開発している表計算ソフトです。
表計算ソフトとは数値データの集計や分析を行うためのソフトウェアのことを指し、
Excel以外にも[OpenOffice](http://www.openoffice.org/)や[Googleドキュメント](https://www.google.com/intl/ja_jp/docs/about/)などが存在しますが、
Excelが**デファクトスタンダード(事実上の標準)**となっています。
一般に、Excelは、マス目状のセル（入力の単位）で構成されたスプレッドシート（単にシートと呼ぶことが多い）に、
数値、文字列、計算式などのデータを入力することで、財務管理や販売管理などに利用されています。
一方で、Excelには、**分析ツール（統計処理）** や **ソルバー（最適化処理）** などの機能が備えられており、統計学的な分析も可能です。
この授業では、統計分析の基本である「相関係数」や「2項分布」などを、Excelを用いた実習形式で学ぶことを目的とします。
マイクロソフトの認定資格である[マイクロソフト・オフィス・スペシャリスト（MOS）](http://mos.odyssey-com.co.jp/index.html)の取得も視野に入れて学習していきましょう。

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">授業の準備

今回、分析対象とするデータは、20人の5教科（国語、算数、理科、英語、社会）の得点リストです。

{% gist naoto-github/dd261e71d8f877b89de21612ef2c1282 %}

まずは、上記のデータを含むファイル [seiseki.csv](seiseki.csv) をダウンロードしましょう。
ファイルをダウンロードするには、ファイルのリンクを右クリックをして、「名前を付けてリンク先を保存」を選択します（ブラウザによって異なる）。
ここで、ファイルは**CSV（Comma Separated Values）**という形式で保存されていることに注意してください。
CSV形式では、対象となるデータ（ここでは得点）が、「,（カンマ）」で区切って入力されています（メモ帳で開いて確認してみてください）。

<!-- ウィンドウズ標準のメモ帳アプリで、ファイルを開くと下記のように表示されます。 -->
<!-- [![https://gyazo.com/98df361b42e7b086016dc1cc74f2d436](https://i.gyazo.com/98df361b42e7b086016dc1cc74f2d436.png)](https://gyazo.com/98df361b42e7b086016dc1cc74f2d436) -->

ファイルをダウンロードしたら、Excelで**seiseki.csv**を読み込んでみましょう。
Excelを起動し、**空白のブック** を選択し、ファイルを新規作成します。
次に**データ**タブに切り替え、**テキストまたはCSVから** をクリックします。
表示された **データの取り込み** のダイアログで**seiseki.csv**を選択し、インポートをクリックします。
最後に、読み込まれるデータを確認したら、**読み込み**をクリックします。

[![https://gyazo.com/9de7685115ec4151652df4df44bca86f](https://i.gyazo.com/9de7685115ec4151652df4df44bca86f.png)](https://gyazo.com/9de7685115ec4151652df4df44bca86f)

Excelで下記のように表示されていれば成功です。
シートの1行目には**項目名**である氏名、国語、算数、理科、英語、社会が入力されています。
また、2行目以降は、20人の生徒の得点リストが入力されています。

[![https://gyazo.com/0bd5def2fc9cd32438da91b71e61ef4d](https://i.gyazo.com/0bd5def2fc9cd32438da91b71e61ef4d.png)](https://gyazo.com/0bd5def2fc9cd32438da91b71e61ef4d)

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">相関係数

読み込んだ得点リストのデータを対象に、**相関係数** を考えていきましょう。
相関係数とは、2種類のデータの関係の強弱を示す指標です。
例えば、夏の暑い日には、アイスクリームがよく売れますよね。
このとき、**温度** と**アイスクリームの売上** には相関があると言えます。
これを定量的に数値で相関の強弱を表したものが **相関係数** です。

まずは、視覚的に相関係数の意味を捉えていきます。
「算数と理科」の組み合わせで散布図を描きます。
算数のC列と理科のD列をマウスで選択し、**挿入**タブの散布図をクリックします。
すると、下図のように、横軸が算数、縦軸が理科である散布図が描けます（タイトル・軸ラベル・軸の境界値を図に合わせて修正してください）。

[![https://gyazo.com/55775cd23bcc993e2913b93068e7b194](https://i.gyazo.com/55775cd23bcc993e2913b93068e7b194.png)](https://gyazo.com/55775cd23bcc993e2913b93068e7b194)

次に、データ系列で右クリックして、**近似曲線の追加**をクリックしてください。
このとき、近似曲線のオプションで**線形近似**を選択します。

[![https://gyazo.com/56dfbcd4191c8aa310ed91b9d3a900bc](https://i.gyazo.com/56dfbcd4191c8aa310ed91b9d3a900bc.png)](https://gyazo.com/56dfbcd4191c8aa310ed91b9d3a900bc)

この結果から、算数と理科には**右上がり**の相関関係があることが分かります。
つまり、「算数が得意な生徒は理科も得意」、逆に、「算数が苦手な生徒は理科も苦手」と考えることができます。
このような相関関係を**正の相関**と呼びます。

今度は、「算数と英語」の組み合わせて散布図を描きます。
算数のC列と英語のE列をマウスで選択し、**挿入**タブの散布図をクリックします（離れたセルを選択するにはCtrlキーを押します）。
すると、下図のように、横軸が算数、縦軸が英語である散布図が描けます（タイトル・軸ラベル・軸の境界値を図に合わせて修正してください）。
このとき、同様に近似曲線も追加してください。

[![https://gyazo.com/7432e940d504371b60bb8fb39ea34eb2](https://i.gyazo.com/7432e940d504371b60bb8fb39ea34eb2.png)](https://gyazo.com/7432e940d504371b60bb8fb39ea34eb2)

この結果から、算数と英語には**右下がり**の相関関係があることが分かります。
つまり、「算数が得意な生徒は英語は苦手」、逆に、「算数が苦手な生徒は英語は得意」と考えることができます。
このような相関関係を**負の相関**と呼びます。

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">相関係数の公式

実際に算数と理科の相関係数を計算してみましょう。
最初に「偏差の積の平均」を表す**共分散**を求めます。
偏差とはそれぞれの値と平均値との差を意味します。

- セル*B22:F22*に、**average関数**で5科目の平均値を求める
- セル*H2:H21*に算数の偏差、セル*I2:I21*に理科の偏差を求める
- セル*J1:J21*に算数と理科の偏差の積を求める
- セル*J22*に、**average関数**で偏差の積の平均（共分散）を求める

[![https://gyazo.com/1fff22f6ccef81c813c09576576d121e](https://i.gyazo.com/1fff22f6ccef81c813c09576576d121e.png)](https://gyazo.com/1fff22f6ccef81c813c09576576d121e)

この結果、算数と理科の共分散は**184.0**と分かります。
この値を算数と理科の標準偏差の積で割った値が**相関係数**です。

- セル*B23:F23*に、**stdev.p関数**で5科目の標準偏差を求める
- セル*J24*に、*=J22/(C23\*D23)*を入力し、相関係数を求める

[![https://gyazo.com/8fa67bc6a0e42b039d0ed7c38e27d979](https://i.gyazo.com/8fa67bc6a0e42b039d0ed7c38e27d979.png)](https://gyazo.com/8fa67bc6a0e42b039d0ed7c38e27d979)

最終的に算数と理科の相関係数は**0.81**になりました。
これは**強い正の相関**を意味しています。

<!-- 同様に算数と英語の相関係数を計算してみましょう。

- セル*I2:I21*に英語の偏差を求める
- セル*J24*に、*=J22/(C23*E23)*を入力し、相関係数を求める

[![https://gyazo.com/b408d93dc23de9aaf5c58b8fc67d04f3](https://i.gyazo.com/b408d93dc23de9aaf5c58b8fc67d04f3.png)](https://gyazo.com/b408d93dc23de9aaf5c58b8fc67d04f3)

算数と英語の相関係数は**-0.57**になりました。
これは**負の相関**を意味しています。 -->

上記で求めたように相関係数は-1から1の範囲をとり、
1に近いほど正の相関となり、-1に近いほど負の相関となります。
一般に相関の強さは下記表で分類します。

| 相関係数   | 相関の強さ   |
|------------|--------------|
| 0.7～1     | 強い正の相関 |
| 0.4～0.7   | 正の相関     |
| 0.2～0.4   | 弱い正の相関 |
| -0.2～0.2  | 相関なし     |
| -0.4～0.2  | 弱い負の相関 |
| -0.7～-0.4 | 負の相関     |
| -1～-0.7   | 強い負の相関 |

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">分析ツールの利用

**分析ツール**を利用して相関係数を求めましょう。
分析ツールは、Excelのアドインであり、相関係数だけでなく**t検定**など高度な統計的分析が可能なツールです。

**データ**タブに切り替え、**データ分析**をクリックします。
一覧から**相関**を選択し、OKをクリックすると、ダイアログが表示されます。
ダイアログに下記の設定をしてから、相関係数を求めて下さい。

- 入力範囲に*B1:F21*を設定する
- 「先頭行をラベルとして使用」にチェックを入れる
- 出力オプションで**新規ワークシート**にチェックを入れる

[![https://gyazo.com/c9aee6db3947c8b166c19fd6e14d3c76](https://i.gyazo.com/c9aee6db3947c8b166c19fd6e14d3c76.png)](https://gyazo.com/c9aee6db3947c8b166c19fd6e14d3c76)

新規に作成されたシートには、下記のように5科目間の相関係数が表形式でまとめられます。
「算数と理科の相関係数」と「算数と英語の相関係数」が先程求めた値と一致していることが分かります。
また、同じ科目（例、算数と算数）の相関係数は**1**であり、１が並ぶ対角線に沿って相関係数は対称となります
（つまり「算数と理科の相関係数」と「理科と算数の相関係数」は一致）。

[![https://gyazo.com/862001579d1ceb829eeb024af936e8c9](https://i.gyazo.com/862001579d1ceb829eeb024af936e8c9.png)](https://gyazo.com/862001579d1ceb829eeb024af936e8c9)

# <img style="margin-right:5px;margin-bottom:7px" src="/favicon/favicon-25x25.png">課題

完成したエクセルファイルを保存し、Glexaから提出しなさい（ファイル名は任意で構わない）。

<!-- バスケットボールのプロリーグ「Bリーグ」の2016-2017シーズンの
平均プレイタイム上位20人の[選手成績のデータ](basketball.csv)を対象として相関係数を求めなさい。
このデータは[Basketballnavi.DB](http://stats.basketballnavi.com/)から取得した。
また、求めた相関係数を基に、下記の設問に答えなさい。

- **身長**と最も正の相関が強い項目
- **リバウンド**と最も負の相関が強い項目 -->

<!-- {% gist naoto-github/b58dbea0a3facf20b09d1bc8b2ec4a5e %} -->

{% include seminar_core_areas_learning/reference.html %}